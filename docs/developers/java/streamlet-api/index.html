<!DOCTYPE html><html lang="en-us"><head><link rel="shortcut icon" type="image/png" sizes="16x16" href="https://twitter.github.io/heron/img/favicon-16x16.png"><link rel="shortcut icon" type="image/png" sizes="32x32" href="https://twitter.github.io/heron/img/favicon-32x32.png"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hugo 0.29" /><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Heron"><meta property="og:image" content="/img/logo54x54.png"><meta property="og:url" content="https://twitter.github.io/heron"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@heronstreaming"><meta name="twitter:title" content="Heron"><meta name="twitter:image" content="/img/HeronTextLogo.png"><meta property="og:site_name" content="The Heron Streamlet API for Java"><meta property="og:url" content="/docs/developers/java/streamlet-api/"><meta property="og:description" content="Create Heron topologies in Java using a functional programming style"><meta name="twitter:description" content="Create Heron topologies in Java using a functional programming style"><title>Heron Documentation - The Heron Streamlet API for Java</title><link rel="stylesheet" href="https://twitter.github.io/heron/css/font-awesome.min.css"><link rel="stylesheet" href="https://twitter.github.io/heron/css/style.css"><script type="text/javascript">
var shiftWindow = function() { scrollBy(0, -100) };
window.addEventListener("hashchange", shiftWindow);
function load() { if (window.location.hash) shiftWindow(); }
</script></head><body class="body"><main class="main"><nav class="hn-top-navbar navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="hn-navbar-container container-fluid"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#hn-navbar" aria-controls="hn-navbar" aria-expanded="false"><span class="sr-only"><Toggle>navigation</Toggle></span><i class="hn-toggle-button fa fa-bars"></i></button><a class="hn-navbar-logo navbar-brand" href="https://twitter.github.io/heron/"><img class="pull-left" src="https://twitter.github.io/heron/img/HeronTextLogo-small.png"></a></div><div id="hn-navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="https://twitter.github.io/heron/docs/getting-started">Docs</a></li><li><a href="https://twitter.github.io/heron/docs/resources">Resources</a></li><li><a href="https://twitter.github.io/heron/docs/contributors/community">Community</a></li><li><a href="https://github.com/twitter/heron">GitHub</a></li><li><a href="https://groups.google.com/forum/#!forum/heron-users">Mailing List</a></li><li><a class="nav-icon" href="https://twitter.com/heronstreaming"><i class="fa fa-twitter"></i></a></li></ul></div></div></nav><div class="hn-main"><div class="container"><div class="row"><aside class="hn-sidebar hidden-xs hidden-sm col-md-4 col-lg-2"><nav class="hn-sidebar-nav"><div id="hn-accordion" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="getting-started" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-getting-started" aria-labelledby="getting-started"><i class="fa fa-caret-right"></i>Getting Started</a></h4></section><div id="collapse-getting-started" class="panel-collapse collapse" aria-labelledby="getting-started"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/getting-started">Local (Single Node)</a></li><li><a href="https://twitter.github.io/heron/docs/migrate-storm-to-heron">Migrate Storm Topologies</a></li><li><a href="https://twitter.github.io/heron/docs/getting-started-troubleshooting">Troubleshooting Guide</a></li></ul></div></div></div><div class="panel panel-default"><section id="the-heron-streamlet-api" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-the-heron-streamlet-api" aria-labelledby="the-heron-streamlet-api"><i class="fa fa-caret-right"></i>The Heron Streamlet API</a></h4></section><div id="collapse-the-heron-streamlet-api" class="panel-collapse collapse" aria-labelledby="the-heron-streamlet-api"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/developers/java/streamlet-api">The Heron Streamlet API for Java</a></li></ul></div></div></div><div class="panel panel-default"><section id="the-heron-topology-api" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-the-heron-topology-api" aria-labelledby="the-heron-topology-api"><i class="fa fa-caret-right"></i>The Heron Topology API</a></h4></section><div id="collapse-the-heron-topology-api" class="panel-collapse collapse" aria-labelledby="the-heron-topology-api"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/developers/java/topologies">The Heron Topology API for Java</a></li><li><a href="https://twitter.github.io/heron/docs/developers/java/effectively-once">Effectively-once Java topologies</a></li><li><a href="https://twitter.github.io/heron/docs/developers/python/topologies">Python Topologies</a></li><li><a href="https://twitter.github.io/heron/docs/developers/data-model">Heron Data Model</a></li><li><a href="https://twitter.github.io/heron/docs/developers/serialization">Tuple Serialization</a></li><li><a href="https://twitter.github.io/heron/docs/developers/ui-guide">Heron UI Guide</a></li><li><a href="https://twitter.github.io/heron/docs/developers/tuning">Tuning Guide</a></li><li><a href="https://twitter.github.io/heron/docs/developers/packing/ffdpacking">Packing Algorithms</a></li><li><a href="https://twitter.github.io/heron/docs/developers/simulator-mode">Simulator Mode</a></li><li><a href="https://twitter.github.io/heron/docs/developers/troubleshooting">Troubleshooting Guide</a></li></ul></div></div></div><div class="panel panel-default"><section id="client-api-docs" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-client-api-docs" aria-labelledby="client-api-docs"><i class="fa fa-caret-right"></i>Client API docs</a></h4></section><div id="collapse-client-api-docs" class="panel-collapse collapse" aria-labelledby="client-api-docs"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/api/java">Java</a></li><li><a href="https://twitter.github.io/heron/api/python">Python</a></li></ul></div></div></div><div class="panel panel-default"><section id="heron-concepts" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-heron-concepts" aria-labelledby="heron-concepts"><i class="fa fa-caret-right"></i>Heron Concepts</a></h4></section><div id="collapse-heron-concepts" class="panel-collapse collapse" aria-labelledby="heron-concepts"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/concepts/design-goals">Heron Design Goals</a></li><li><a href="https://twitter.github.io/heron/docs/concepts/topologies">Heron Topologies</a></li><li><a href="https://twitter.github.io/heron/docs/concepts/architecture">Heron Architecture</a></li><li><a href="https://twitter.github.io/heron/docs/concepts/delivery-semantics">Heron Delivery Semantics</a></li></ul></div></div></div><div class="panel panel-default"><section id="deployment" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-deployment" aria-labelledby="deployment"><i class="fa fa-caret-right"></i>Deployment</a></h4></section><div id="collapse-deployment" class="panel-collapse collapse" aria-labelledby="deployment"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/operators/deployment">Overview</a></li><li><a href="https://twitter.github.io/heron/docs/operators/deployment/configuration">Configuration</a></li><li><a href="https://twitter.github.io/heron/docs/operators/heron-api-server">The Heron API server</a></li></ul></div></div></div><div class="panel panel-default"><section id="state-managers" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-state-managers" aria-labelledby="state-managers"><i class="fa fa-caret-right"></i>State Managers</a></h4></section><div id="collapse-state-managers" class="panel-collapse collapse" aria-labelledby="state-managers"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/operators/deployment/statemanagers/zookeeper">Zookeeper</a></li><li><a href="https://twitter.github.io/heron/docs/operators/deployment/statemanagers/localfs">Local FS</a></li></ul></div></div></div><div class="panel panel-default"><section id="uploaders" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-uploaders" aria-labelledby="uploaders"><i class="fa fa-caret-right"></i>Uploaders</a></h4></section><div id="collapse-uploaders" class="panel-collapse collapse" aria-labelledby="uploaders"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/operators/deployment/uploaders/localfs">Local FS</a></li><li><a href="https://twitter.github.io/heron/docs/operators/deployment/uploaders/hdfs">HDFS</a></li><li><a href="https://twitter.github.io/heron/docs/operators/deployment/uploaders/s3">Amazon S3</a></li><li><a href="https://twitter.github.io/heron/docs/operators/deployment/uploaders/scp">Secure Copy (SCP)</a></li></ul></div></div></div><div class="panel panel-default"><section id="schedulers" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-schedulers" aria-labelledby="schedulers"><i class="fa fa-caret-right"></i>Schedulers</a></h4></section><div id="collapse-schedulers" class="panel-collapse collapse" aria-labelledby="schedulers"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/operators/deployment/schedulers/kubernetes">Kubernetes</a></li><li><a href="https://twitter.github.io/heron/docs/operators/deployment/schedulers/aurora">Aurora Cluster</a></li><li><a href="https://twitter.github.io/heron/docs/operators/deployment/schedulers/local">Local Cluster</a></li><li><a href="https://twitter.github.io/heron/docs/operators/deployment/schedulers/mesos-local-mac">Mesos Cluster Locally</a></li><li><a href="https://twitter.github.io/heron/docs/operators/deployment/schedulers/slurm">Slurm Cluster</a></li><li><a href="https://twitter.github.io/heron/docs/operators/deployment/schedulers/yarn">YARN Cluster</a></li></ul></div></div></div><div class="panel panel-default"><section id="cluster-configuration" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-cluster-configuration" aria-labelledby="cluster-configuration"><i class="fa fa-caret-right"></i>Cluster Configuration</a></h4></section><div id="collapse-cluster-configuration" class="panel-collapse collapse" aria-labelledby="cluster-configuration"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/operators/configuration/config-intro">Overview</a></li><li><a href="https://twitter.github.io/heron/docs/operators/configuration/system">System-Level</a></li><li><a href="https://twitter.github.io/heron/docs/operators/configuration/instance">Heron Instance</a></li><li><a href="https://twitter.github.io/heron/docs/operators/configuration/metrics-manager">Metrics Manager</a></li><li><a href="https://twitter.github.io/heron/docs/operators/configuration/stmgr">Stream Manager</a></li><li><a href="https://twitter.github.io/heron/docs/operators/configuration/tmaster">Topology Master</a></li></ul></div></div></div><div class="panel panel-default"><section id="observability" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-observability" aria-labelledby="observability"><i class="fa fa-caret-right"></i>Observability</a></h4></section><div id="collapse-observability" class="panel-collapse collapse" aria-labelledby="observability"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/operators/observability/prometheus">Prometheus</a></li><li><a href="https://twitter.github.io/heron/docs/operators/observability/graphite">Graphite</a></li><li><a href="https://twitter.github.io/heron/docs/operators/observability/scribe">Scribe</a></li></ul></div></div></div><div class="panel panel-default"><section id="user-manuals" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-user-manuals" aria-labelledby="user-manuals"><i class="fa fa-caret-right"></i>User Manuals</a></h4></section><div id="collapse-user-manuals" class="panel-collapse collapse" aria-labelledby="user-manuals"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/operators/heron-cli">Heron Client</a></li><li><a href="https://twitter.github.io/heron/docs/operators/heron-explorer">Heron Explorer</a></li><li><a href="https://twitter.github.io/heron/docs/operators/heron-tracker-api">Heron Tracker REST API</a></li><li><a href="https://twitter.github.io/heron/docs/operators/heron-tracker">Heron Tracker Runbook</a></li><li><a href="https://twitter.github.io/heron/docs/operators/heron-ui">Heron UI Runbook</a></li></ul></div></div></div><div class="panel panel-default"><section id="heron-developers" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-heron-developers" aria-labelledby="heron-developers"><i class="fa fa-caret-right"></i>Heron Developers</a></h4></section><div id="collapse-heron-developers" class="panel-collapse collapse" aria-labelledby="heron-developers"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/developers/compiling/compiling">Compiling</a></li><li><a href="https://twitter.github.io/heron/docs/developers/compiling/linux">Compiling on Linux</a></li><li><a href="https://twitter.github.io/heron/docs/developers/compiling/mac">Compiling on Mac OS X</a></li><li><a href="https://twitter.github.io/heron/docs/developers/compiling/docker">Compiling With Docker</a></li><li><a href="https://twitter.github.io/heron/docs/contributors/testing">Running Tests</a></li><li><a href="https://twitter.github.io/heron/docs/contributors/codebase">Code Organization</a></li></ul></div></div></div><div class="panel panel-default"><section id="extending-heron" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-extending-heron" aria-labelledby="extending-heron"><i class="fa fa-caret-right"></i>Extending Heron</a></h4></section><div id="collapse-extending-heron" class="panel-collapse collapse" aria-labelledby="extending-heron"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/contributors/custom-scheduler">Custom Scheduler</a></li><li><a href="https://twitter.github.io/heron/docs/contributors/custom-metrics-sink">Custom Metrics Sink</a></li></ul></div></div></div><div class="panel panel-default"><section id="heron-resources" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-heron-resources" aria-labelledby="heron-resources"><i class="fa fa-caret-right"></i>Heron Resources</a></h4></section><div id="collapse-heron-resources" class="panel-collapse collapse" aria-labelledby="heron-resources"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/resources">Heron Resources</a></li></ul></div></div></div><div class="panel panel-default"><section id="contributors" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-contributors" aria-labelledby="contributors"><i class="fa fa-caret-right"></i>Contributors</a></h4></section><div id="collapse-contributors" class="panel-collapse collapse" aria-labelledby="contributors"><div class="panel-body"><ul><li><a href="https://twitter.github.io/heron/docs/contributors/community">Community</a></li><li><a href="https://twitter.github.io/heron/docs/contributors/governance">Governance</a></li></ul></div></div></div></div></nav></aside><section class="hn-docs-main col-xs-12 col-sm-12 col-md-8 col-lg-10 col-md-offset-4 col-lg-offset-2"><header class="hn-docs-header page-header"><h1 class="hn-docs-title">The Heron Streamlet API for Java</h1><div class="hn-docs-description">Create Heron topologies in Java using a functional programming style</div></header><article class="hn-docs-content">
<div class="alert alert-success alert-dismissible" role="alert">
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button><h4 class="alert-heading">The Heron Streamlet API is in beta</h4>The Heron Streamlet API is well tested and can be used to build and test topologies locally. The API is not yet fully stable, however, and breaking changes are likely in the coming weeks.
</div>

<p>Heron processing topologies can be written using an API called the <strong>Heron Functional API</strong>. The Heron Functional API is currently available for the following languages:</p>

<ul>
<li><a href="../../../developers/java/functional-api">Java</a>
<!-- * [Python](../../../developers/python/functional-api) --></li>
</ul>

<blockquote>
<p>Although the original <a href="../../../concepts/topologies">topology API</a> can still be used with Heron (which means that all of your older topologies will still run) we strongly recommend creating all new topologies using the Heron Functional API, for reasons outlined in the section below.</p>
</blockquote>

<h2 id="the-heron-functional-api-vs-the-topology-api">The Heron Functional API vs. the topology API</h2>

<p>When Heron was first released, all Java topologies needed to be written using an API based on the <a href="../topologies">Storm topology API</a>. Although this API is quite powerful (and can still be used), the <strong>Heron Functional API</strong> enables you to create topologies without needing to implement spouts and bolts or connect spouts and bolts together.</p>

<p>Here are some crucial differences between the two APIs:</p>

<table>
<thead>
<tr>
<th align="left">Domain</th>
<th align="left">Original topology API</th>
<th align="left">Heron Functional API</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">Programming style</td>
<td align="left">Procedural, processing component based</td>
<td align="left">Functional</td>
</tr>

<tr>
<td align="left">Abstraction level</td>
<td align="left"><strong>Low level</strong>. Developers must think in terms of &quot;physical&quot; spout and bolt implementation logic.</td>
<td align="left"><strong>High level</strong>. Developers can write processing logic in an idiomatic fashion in the language of their choice, without needing to write and connect spouts and bolts.</td>
</tr>

<tr>
<td align="left">Processing model</td>
<td align="left"><a href="../spouts">Spout</a> and <a href="../bolts">bolt</a> logic must be created explicitly, and connecting spouts and bolts is the responsibility of the developer</td>
<td align="left">Spouts and bolts are created for you automatically on the basis of the processing graph that you build</td>
</tr>
</tbody>
</table>

<p>The two APIs also have a few things in common:</p>

<ul>
<li>Topologies' <a href="../../../concepts/topologies#logical-plan">logical</a> and <a href="../../../concepts/topologies#physical-plan">physical</a> plans are automatically created by Heron</li>
<li>Topologies are <a href="../../../operators/heron-cli">managed</a> in the same way using the <code>heron</code> CLI tool</li>
</ul>

<h2 id="getting-started">Getting started</h2>

<p>In order to use the Heron Functional API for Java, you'll need to install the <code>heron-api</code> library.</p>

<h3 id="maven-setup">Maven setup</h3>

<p>In order to use the <code>heron-api</code> library, add this to the <code>dependencies</code> block of your <code>pom.xml</code> configuration file:</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.twitter.heron<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>heron-api<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>0.16.5<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>

<h4 id="compiling-a-jar-with-dependencies">Compiling a JAR with dependencies</h4>

<p>In order to run a Java Functional API topology in a Heron cluster, you'll need to package your topology as a &quot;fat&quot; JAR with dependencies included. You can use the <a href="https://maven.apache.org/plugins/maven-assembly-plugin/usage.html">Maven Assembly Plugin</a> to generate JARs with dependencies. To install the plugin and add a Maven goal for a single JAR, add this to the <code>plugins</code> block in your <code>pom.xml</code>:</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>maven-assembly-plugin<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;descriptorRefs&gt;</span>
            <span class="nt">&lt;descriptorRef&gt;</span>jar-with-dependencies<span class="nt">&lt;/descriptorRef&gt;</span>
        <span class="nt">&lt;/descriptorRefs&gt;</span>
        <span class="nt">&lt;archive&gt;</span>
            <span class="nt">&lt;manifest&gt;</span>
                <span class="nt">&lt;mainClass&gt;&lt;/mainClass&gt;</span>
            <span class="nt">&lt;/manifest&gt;</span>
        <span class="nt">&lt;/archive&gt;</span>
    <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;executions&gt;</span>
        <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;id&gt;</span>make-assembly<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;phase&gt;</span>package<span class="nt">&lt;/phase&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
                <span class="nt">&lt;goal&gt;</span>single<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
        <span class="nt">&lt;/execution&gt;</span>
    <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre></div>

<p>Once your <code>pom.xml</code> is properly set up, you can compile the JAR with dependencies using this command:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ mvn assembly:assembly
</code></pre></div>

<p>By default, this will add a JAR in your project's <code>target</code> folder with the name <code>PROJECT-NAME-VERSION-jar-with-dependencies.jar</code>. Here's an example topology submission command using a compiled JAR:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ mvn assembly:assembly
$ heron submit <span class="nb">local</span> <span class="se">\</span>
  target/my-project-1.2.3-jar-with-dependencies.jar <span class="se">\</span>
  com.example.Main <span class="se">\</span>
  MyTopology arg1 arg2
</code></pre></div>

<h3 id="java-streamlet-api-starter-project">Java Streamlet API starter project</h3>

<p>If you'd like to up and running quickly with the Heron Streamlet API for Java, you can clone <a href="https://github.com/streamlio/heron-java-streamlet-api-example">this repository</a>, which includes an example topology built using the Functional API as well as the necessary Maven configuration. To build a JAR with dependencies of this example topology:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ git clone https://github.com/streamlio/heron-java-streamlet-api-example
$ <span class="nb">cd</span> heron-java-streamlet-api-example
$ mvn assembly:assembly
$ ls target/*.jar
target/heron-java-streamlet-api-example-latest-jar-with-dependencies.jar
target/heron-java-streamlet-api-example-latest.jar
</code></pre></div>

<p>If you're running a <a href="../../../getting-started">local Heron cluster</a>, you can submit the built example topology like this:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ heron submit <span class="nb">local</span> target/heron-java-streamlet-api-example-latest-jar-with-dependencies.jar <span class="se">\</span>
  io.streaml.heron.streamlet.IntegerProcessingTopology <span class="se">\</span>
  IntegerProcessingTopology
</code></pre></div>

<h4 id="selecting-delivery-semantics">Selecting delivery semantics</h4>

<p>Heron enables you to apply one of three <a href="../../../concepts/delivery-semantics">delivery semantics</a> to any Heron topology. For the <a href="#java-functional-api-starter-project">example topology</a> above, you can select the delivery semantics when you submit the topology with the topology's second argument. This command, for example, would apply <a href="../../../concepts/delivery-semantics">effectively-once</a> to the example topology:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ heron submit <span class="nb">local</span> target/heron-java-streamlet-api-example-latest-jar-with-dependencies.jar <span class="se">\</span>
  io.streaml.heron.streamlet.IntegerProcessingTopology <span class="se">\</span>
  IntegerProcessingTopology <span class="se">\</span>
  effectively-once
</code></pre></div>

<p>The other options are <code>at-most-once</code> and <code>at-least-once</code>. If you don't explicitly select the delivery semantics, at-least-once semantics will be applied.</p>

<h2 id="streamlet-api-topology-configuration">Streamlet API topology configuration</h2>

<p>Every Streamlet API topology needs to be configured using a <code>Config</code> object. Here's an example baseline configuration:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.twitter.heron.streamlet.Config</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.twitter.heron.streamlet.Runner</span><span class="o">;</span>

<span class="n">Config</span> <span class="n">topologyConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Config</span><span class="o">();</span>

<span class="c1">// Apply topology configuration using the topologyConfig object</span>

<span class="n">Runner</span> <span class="n">topologyRunner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Runner</span><span class="o">();</span>
<span class="n">topologyRunner</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="s">&quot;name-for-topology&quot;</span><span class="o">,</span> <span class="n">conf</span><span class="o">,</span> <span class="n">topologyBuilder</span><span class="o">);</span>
</code></pre></div>

<p>You can set the following in the configuration: the topology's <a href="#delivery-semantics">delivery semantics</a>, the number of <a href="#containers-and-resources">containers</a> to be used by the topology, and the total CPU and RAM resources for the topology.</p>

<h3 id="delivery-semantics">Delivery semantics</h3>

<p>You can apply <a href="../../../concepts/delivery-semantics">delivery semantics</a> to a Functional API topology like this:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">topologyConfig</span>
        <span class="o">.</span><span class="na">setDeliverySemantics</span><span class="o">(</span><span class="n">Config</span><span class="o">.</span><span class="na">DeliverySemantics</span><span class="o">.</span><span class="na">EFFECTIVELY_ONCE</span><span class="o">);</span>
</code></pre></div>

<p>The other available options are <code>ATMOST_ONCE</code> and <code>ATLEAST_ONCE</code>.</p>

<h3 id="containers-and-resources">Containers and resources</h3>

<p>You can set the number of containers to be used by a Functional API topology (as an integer) like so:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">topologyConfig</span><span class="o">.</span><span class="na">setNumContainers</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
</code></pre></div>

<p>You can set the CPU per container (as a <code>float</code>) and RAM per container (as a <code>long</code> expressing the number of bytes) like this:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.twitter.heron.streamlet.Resources</span><span class="o">;</span>

<span class="n">Resources</span> <span class="n">resources</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Resources</span><span class="o">();</span>
<span class="n">resources</span><span class="o">.</span><span class="na">withCpu</span><span class="o">(</span><span class="mf">2.0f</span><span class="o">);</span>
<span class="n">resources</span><span class="o">.</span><span class="na">withRam</span><span class="o">(</span><span class="mi">104857600</span><span class="o">);</span>

<span class="n">topologyConfig</span><span class="o">.</span><span class="na">setContainerResources</span><span class="o">(</span><span class="n">resources</span><span class="o">);</span>
</code></pre></div>

<blockquote>
<p>The default CPU is <code>1.0f</code> while the default RAM is <code>104857600</code> (100 megabytes).</p>
</blockquote>

<p>There's also a <code>ByteAmount</code> helper class that you can use to convert byte formats:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.twitter.heron.common.basics.ByteAmount</span><span class="o">;</span>

<span class="n">resources</span><span class="o">.</span><span class="na">withRam</span><span class="o">(</span><span class="n">ByteAmount</span><span class="o">.</span><span class="na">fromMegabytes</span><span class="o">(</span><span class="mi">192</span><span class="o">).</span><span class="na">asMegabytes</span><span class="o">());</span>
</code></pre></div>

<h2 id="streamlets">Streamlets</h2>

<p>In the Heron Functional API for Java, processing graphs consist of <a href="../../../concepts/topologies#streamlets">streamlets</a>. One or more supplier streamlets inject data into your graph to be processed by downstream operators.</p>

<h2 id="operations">Operations</h2>

<table>
<thead>
<tr>
<th align="left">Operation</th>
<th align="left">Description</th>
<th align="left">Example</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><a href="#map-operations"><code>map</code></a></td>
<td align="left">Create a new streamlet by applying the supplied mapping function to each element in the original streamlet</td>
<td align="left">Add 1 to each element in a streamlet of integers</td>
</tr>

<tr>
<td align="left"><a href="#flatmap-operations"><code>flatMap</code></a></td>
<td align="left">Like a map operation but with the important difference that each element of the streamlet is flattened</td>
<td align="left">Flatten a sentence into individual words</td>
</tr>

<tr>
<td align="left"><a href="#join-operations"><code>join</code></a></td>
<td align="left">Create a new streamlet by combining two separate key-value streamlets into one on the basis of each element's key</td>
<td align="left">Combine key-value pairs listing current scores (e.g. <code>(&quot;h4x0r&quot;, 127)</code>) for each user into a single per-user stream</td>
</tr>

<tr>
<td align="left"><a href="#filter-operations"><code>filter</code></a></td>
<td align="left">Create a new streamlet containing only the elements that satisfy the supplied filtering function</td>
<td align="left">Remove all inappropriate words from a streamlet of strings</td>
</tr>

<tr>
<td align="left"><a href="#repartition-operations"><code>repartition</code></a></td>
<td align="left">Create a new streamlet by applying a new parallelism level to the original streamlet</td>
<td align="left">Increase the parallelism of a streamlet from 5 to 10</td>
</tr>

<tr>
<td align="left"><a href="#map-to-kv-operations"><code>mapToKV</code></a></td>
<td align="left">Create a new key-value streamlet by converting each element in the original streamlet into a <code>KeyValue</code> object</td>
<td align="left">Convert each element of a string streamlet into a <code>KeyValue</code> object where the current time is the key and the original string is the value</td>
</tr>

<tr>
<td align="left"><code>log</code></td>
<td align="left">Logs the final results of a processing graph to stdout. This <em>must</em> be the last step in the graph.</td>
<td align="left"></td>
</tr>
</tbody>
</table>

<!-- [`union`](#union-operations) | Create a new streamlet by combining two separate non-key-value streamlets into one | Combine two integer streamlets into one -->

<h3 id="map-operations">Map operations</h3>

<p>Map operations create a new streamlet by applying the supplied mapping function to each element in the original streamlet. Here's an example:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">builder</span><span class="o">.</span><span class="na">newSource</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="o">)</span>
    <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">12</span><span class="o">);</span>
</code></pre></div>

<p>In this example, a supplier streamlet emits an indefinite series of 1s. The <code>map</code> operation then adds 12 to each incoming element, producing a streamlet of 13s.</p>

<h3 id="flatmap-operations">FlatMap operations</h3>

<p>FlatMap operations are like map operations but with the important difference that each element of the streamlet is &quot;flattened&quot; into another type. In this example, a supplier streamlet emits the same sentence over and over again; the <code>flatMap</code> operation transforms each sentence into a Java <code>List</code> of individual words:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">builder</span><span class="o">.</span><span class="na">newSource</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="s">&quot;I have nothing to declare but my genius&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">flatMap</span><span class="o">((</span><span class="n">sentence</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">sentence</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;\\s+&quot;</span><span class="o">)));</span>
</code></pre></div>

<p>The effect of this operation is to transform the <code>Streamlet&lt;String&gt;</code> into a <code>Streamlet&lt;List&lt;String&gt;&gt;</code>.</p>

<blockquote>
<p>One of the core differences between map and flatMap operations is that flatMap operations typically transform non-collection types into collection types.</p>
</blockquote>

<h3 id="join-operations">Join operations</h3>

<p>Join operations unify two streamlets <em>on a key</em> (join operations thus require KV streamlets). Each <code>KeyValue</code> object in a streamlet has, by definition, a key. When a join operation is added to a processing graph,</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.twitter.heron.streamlet.WindowConfig</span><span class="o">;</span>

<span class="n">Builder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">Builder</span><span class="o">.</span><span class="na">CreateBuilder</span><span class="o">();</span>

<span class="n">KVStreamlet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">streamlet1</span> <span class="o">=</span>
        <span class="n">builder</span><span class="o">.</span><span class="na">newKVSource</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">KeyValue</span><span class="o">&lt;&gt;(</span><span class="s">&quot;heron-api&quot;</span><span class="o">,</span> <span class="s">&quot;topology-api&quot;</span><span class="o">));</span>

<span class="n">builder</span><span class="o">.</span><span class="na">newSource</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">KeyValue</span><span class="o">&lt;&gt;(</span><span class="s">&quot;heron-api&quot;</span><span class="o">,</span> <span class="s">&quot;functional-api&quot;</span><span class="o">))</span>
    <span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="n">streamlet1</span><span class="o">,</span> <span class="n">WindowConfig</span><span class="o">.</span><span class="na">TumblingCountWindow</span><span class="o">(</span><span class="mi">10</span><span class="o">),</span> <span class="n">KeyValue</span><span class="o">::</span><span class="n">create</span><span class="o">);</span>
</code></pre></div>

<p>In this case, the resulting streamlet would consist of an indefinite stream with two <code>KeyValue</code> objects with the key <code>heron-api</code> but different values (<code>topology-api</code> and <code>functional-api</code>).</p>

<blockquote>
<p>The effect of a join operation is to create a new streamlet <em>for each key</em>.</p>
</blockquote>

<h3 id="filter-operations">Filter operations</h3>

<p>Filter operations retain elements in a streamlet, while potentially excluding some or all elements, on the basis of a provided filtering function. Here's an example:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Builder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">Builder</span><span class="o">.</span><span class="na">CreateBuilder</span><span class="o">();</span>

<span class="n">builder</span><span class="o">.</span><span class="na">newSource</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">ThreadLocalRandom</span><span class="o">.</span><span class="na">current</span><span class="o">().</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">11</span><span class="o">))</span>
</code></pre></div>

<h3 id="repartition-operations">Repartition operations</h3>

<p>When you assign a number of <a href="#partitioning-and-parallelism">partitions</a> to a processing step, each step that comes after it inherits that number of partitions. Thus, if you assign 5 partitions to a <code>map</code> operation, then any <code>mapToKV</code>, <code>flatMap</code>, <code>filter</code>, etc. operations that come after it will also be assigned 5 partitions. But you can also change the number of partitions for a processing step (as well as the number of partitions for downstream operations) using <code>repartition</code>. Here's an example:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">java.util.concurrent.ThreadLocalRandom</span><span class="o">;</span>

<span class="n">Builder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">Builder</span><span class="o">.</span><span class="na">CreateBuilder</span><span class="o">();</span>

<span class="n">builder</span><span class="o">.</span><span class="na">newSource</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">ThreadLocalRandom</span><span class="o">.</span><span class="na">current</span><span class="o">().</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">11</span><span class="o">))</span>
        <span class="o">.</span><span class="na">setNumPartitions</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
        <span class="o">.</span><span class="na">repartition</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
        <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="o">)</span>
        <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">)</span>
        <span class="o">.</span><span class="na">log</span><span class="o">();</span>
</code></pre></div>

<p>In this example, the supplier streamlet emits random integers between one and ten. That operation is assigned 5 partitions. After the <code>map</code> operation, the <code>repartition</code> function is used to assign 2 partitions to all downstream operations.</p>

<h3 id="maptokv-operations">Map-to-KV operations</h3>

<p>Map-to-KV operations enable you to transform a streamlet into a KV streamlet, for example a <code>Streamlet&lt;String&gt;</code> into a <code>Streamlet&lt;KeyValue&lt;String, Boolean&gt;&gt;</code>, using a mapping function. Here's an example:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Builder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">Builder</span><span class="o">.</span><span class="na">CreateBuilder</span><span class="o">();</span>

<span class="n">builder</span><span class="o">.</span><span class="na">newSource</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">randomIntGenerator</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">100</span><span class="o">))</span>
        <span class="o">.</span><span class="na">mapToKV</span><span class="o">((</span><span class="n">num</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">KeyValue</span><span class="o">&lt;&gt;(</span><span class="n">num</span><span class="o">,</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="o">));</span>
</code></pre></div>

<p>In this example processing graph, the supplier streamlet is a function that continuously emits random integers between 1 and 100. The <code>mapToKV</code> operation then returns a <code>KeyValue&lt;Integer, Boolean&gt;</code> object, for each integer in the streamlet, in which the key is the number and the value is whether the integer is even.</p>

<!--

## Partitioning and parallelism

In the original, Storm-inspired topology API for Heron, you could manage parallelism within your topologies by controlling the number of spouts or bolts performing a specific ingestion or processing operation. The Heron Functional API is different in that you assign **partitions** to specific operations.

-->
</article></section></div></div></div></main><script src="https://code.jquery.com/jquery-2.2.1.min.js"></script><script src="https://twitter.github.io/heron/js/app.min.js"></script><script type="text/javascript">
$('pre code').each(function() {
  console.log(this);
  this.innerHTML = this.innerHTML.replace(/\$\s/g, function(matched) {
    return `<span class=\"clp\">${matched}</span>`;
  });
});
</script></body></html>